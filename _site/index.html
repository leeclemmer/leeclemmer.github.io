<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Lee Clemmer</title>
    <meta name="description" content="Occasional writing on data-related topics.
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://leeclemmer.github.io/">

    <script async src="//genius.codes"></script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Lee Clemmer</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
          <a class="page-link" href="/all_posts/">All Posts</a>
          <a class="page-link" href="/about/">About</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

  <h1 class="page-heading">Posts</h1>

  <ul class="post-list">
    
      <!--<li>
        <span class="post-meta">Sep 2, 2014</span>

        <h2>
          <a class="post-link" href="/2014/09/02/2047-nfl-player-faces-combined-into-one.html">2,047 NFL Player Faces Combined Into One</a>
        </h2>
      </li>-->

      <div class="post">
          <header class="post-header">
            <h1 class="post-title">2,047 NFL Player Faces Combined Into One</h1>     
            <p class="post-meta">Sep 2, 2014 | <a href="/2014/09/02/2047-nfl-player-faces-combined-into-one.html">Permalink</a></p>
          </header>

          <article class="post-content">
            <p>Here in the U.S. we’re back to work after a long Labor Day weekend and getting excited for the first regular season NFL game on Thursday between the Packers and Seahawks. What better excuse to play around with some facial averaging?</p>

<p>There is no shortage of available football statistics and metrics, but having recently stumbled upon the <a href="http://www.businessinsider.com/faces-of-tomorrow-2011-2?op=1">Face of Tomorrow project</a>, I wondered: just what does the average face of an NFL player look like? Using <a href="http://users.aber.ac.uk/bpt/jpsychomorph/">psychomorph</a>, a bit of Python scripting, and player images from nfl.com, I set out to answer this question.</p>

<p>What I ended up with is the average face of 2,047 available images (875 players did not have a profile image). I also wondered if there were any differences in player build between different positions. After some experimentation, I decided to group some of the positions for simplification (for example, there wasn’t much difference between the average face of Middle Linebacker and an Inside Linebacker).</p>

<p>Here are the results.</p>

<p><img src="/images/face_of_nfl.jpg" alt="The Face of NFL Players" /></p>

          </article>
        </div>
    
      <!--<li>
        <span class="post-meta">Jan 8, 2014</span>

        <h2>
          <a class="post-link" href="/2014/01/08/leaked-snapchat-data-uncovers-surprising-patterns.html">Leaked Snapchat Data Uncovers Surprising Patterns</a>
        </h2>
      </li>-->

      <div class="post">
          <header class="post-header">
            <h1 class="post-title">Leaked Snapchat Data Uncovers Surprising Patterns</h1>     
            <p class="post-meta">Jan 8, 2014 | <a href="/2014/01/08/leaked-snapchat-data-uncovers-surprising-patterns.html">Permalink</a></p>
          </header>

          <article class="post-content">
            <p>A new year, a new data leak.</p>

<p>On New Year’s Eve an anonymous group or person leaked about 4.6 million Snapchat usernames along with the associated phone numbers, save for the last two digits.</p>

<p>The leak came about a week after Snapchat dismissed the threat – brought to their attention by Gibson Security - in a <a href="http://blog.snapchat.com/post/71353347590/finding-friends-with-phone-numbers">blogpost</a>: “Theoretically, if someone were able to upload a huge set of phone numbers, like every number in an area code, or every possible number in the U.S., they could create a database of the results and match usernames to phone numbers that way. Over the past year we’ve implemented various safeguards to make it more difficult to do. We recently added additional counter-measures and continue to make improvements to combat spam and abuse.”</p>

<p>Apparently their counter-measures weren’t enough.</p>

<p>Soon after the breach, the alleged hackers responded to requests for comment by <em><a href="http://www.theverge.com/2014/1/1/5263156/alleged-snapchat-hackers-explain-how-and-why-they-leaked-data-on-accounts">The Verge</a></em>: “Our motivation behind the release was to raise the public awareness around the issue, and also put public pressure on Snapchat to get this exploit fixed,” they say. “Security matters as much as user experience does.”  Snapchat CEO responded to the breach in <a href="http://www.today.com/video/today/53971379">this NBC interview</a>: “We thought we had done enough.”</p>

<p>I examined the data to see if there’s anything we can learn.</p>

<p>What I discovered was something I hadn’t really thought of before, namely information encoded within other information.  A straight-forward example is geographical information being encoded in the first three digits of a telephone number. Looking at usernames, I learned that we humans sometimes include quite a bit of information about ourselves in those usernames – for example our actual, real name.  So a username can be more than just a username.</p>

<p>Let’s start by taking a look at the telephone numbers. We can see what users have been affected by this data breach by taking a look at the area codes of the phone numbers (to see if you are part of the leaked data, <a href="http://lookup.gibsonsec.org/">you can search for your name here</a>.) As mentioned in various reports, the leaks only affect North American users.  You can find the <a href="http://en.wikipedia.org/wiki/List_of_North_American_Numbering_Plan_area_codes">list of North American phone numbers on Wikipedia</a>: there are 323 American and 41 Canadian area codes.  After loading up the data in R (the application for statistical computing), I split the telephone numbers and counted the area codes.  There are 76 in total, two from Canada and the rest from the U.S. (<a href="/files/Snapchat Area Code Frequencies and States.csv">download CSV here</a>).</p>

<p>Here are the top 10 area codes:</p>

<table>
  <thead>
    <tr>
      <th>Area Code</th>
      <th>Frequency</th>
      <th>State</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>815</td>
      <td>215,953</td>
      <td>Illinois</td>
    </tr>
    <tr>
      <td>909</td>
      <td>215,855</td>
      <td>California</td>
    </tr>
    <tr>
      <td>818</td>
      <td>205,544</td>
      <td>California</td>
    </tr>
    <tr>
      <td>951</td>
      <td>200,008</td>
      <td>California</td>
    </tr>
    <tr>
      <td>310</td>
      <td>196,183</td>
      <td>California</td>
    </tr>
    <tr>
      <td>847</td>
      <td>195,925</td>
      <td>Illinois</td>
    </tr>
    <tr>
      <td>720</td>
      <td>188,285</td>
      <td>Colorado</td>
    </tr>
    <tr>
      <td>323</td>
      <td>168,565</td>
      <td>California</td>
    </tr>
    <tr>
      <td>347</td>
      <td>166,374</td>
      <td>New York</td>
    </tr>
    <tr>
      <td>917</td>
      <td>165,420</td>
      <td>New York</td>
    </tr>
  </tbody>
</table>

<p>Next I fired up SAP Lumira to take advantage of the great mapping features it has (<a href="http://go.sap.com/product/analytics/lumira.html">you can get your free copy here</a>).  Here’s a choropleth map showing which states have been affected the most by the leak. If you live in a grey state, you’re not part of the leak.  If you’re in a green state, you may want to check to see if you’re data has been compromised (<a href="http://lookup.gibsonsec.org/">you can check here</a>).</p>

<p><img src="/images/snapchat_leaks_image_1.png" alt="Snapchat Data Map" /></p>

<p>The leaked data also comes marked up with regional information below the state level, which after looking into a bit I’m confident is accurate.  Here are the top 10 regional locations affected by the leaks (<a href="/files/Snapchat Regional Frequencies.csv">download CSV here</a>):</p>

<table>
  <thead>
    <tr>
      <th>Region</th>
      <th>Frequency</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>New York City</td>
      <td>334,445</td>
    </tr>
    <tr>
      <td>Miami</td>
      <td>222,321</td>
    </tr>
    <tr>
      <td>Chicago Suburbs</td>
      <td>215,953</td>
    </tr>
    <tr>
      <td>Eastern Los Angeles</td>
      <td>215,855</td>
    </tr>
    <tr>
      <td>Los Angeles</td>
      <td>209,888</td>
    </tr>
    <tr>
      <td>San Fernando Valley</td>
      <td>205,544</td>
    </tr>
    <tr>
      <td>Southern California</td>
      <td>200,008</td>
    </tr>
    <tr>
      <td>Northern Chicago Suburbs</td>
      <td>195,925</td>
    </tr>
    <tr>
      <td>Denver-Boulder</td>
      <td>188,285</td>
    </tr>
    <tr>
      <td>Downtown Los Angeles</td>
      <td>168,565</td>
    </tr>
  </tbody>
</table>

<p>As this dataset is incomplete, we can only really draw conclusions about what users have been affected by this leak.  Some larger urban areas – like my Philadelphia – are fairly low on the list. I wouldn’t conclude that Snapchat is unpopular there, simply that it wasn’t hit as hard.</p>

<p>Now let’s take a look at the usernames and see what kind of information is contained in those.  To start, we’ll just get a sense of how long these usernames are.  What we get is a nice, nearly normal distribution with a bit of right skew.  Looking at the data, I would guess that Snapchat requires a username of between 3 and 15 characters.  However, there are exactly 5 notable outliers (excluded in the histogram below), users for whom their email address has been published instead of their username (unless these 5 could choose to have their username be their email?).  I wonder how these 5 got to be included in this data set.</p>

<p><img src="/images/snapchat_leaks_image_2.png" alt="Distribution of Name Length" /></p>

<p>A lot of usernames appear to be people’s actual names.  After Googling random ones, it turns out it’s almost trivially easy to start connecting this data to additional information like names, pictures, Facebook accounts, Tumblr blogs, Twitter accounts, etc.</p>

<p>So what are popular names of Snapchat users?  I decided to count how many usernames started with an actual first name.  To get a list of first names to search against, I got a list of <a href="http://www.ssa.gov/oact/babynames/limits.html">popular baby names posted by the Social Security Administration</a> and created a list of the top 50 boy and girl names (so 100 names in total) since 1980.  Next I counted how many times each name occurred at the beginning of a Snapchat username.  Of all Snapchat usernames, about 8% start with a top 100 name. Here’s the top 10 list of most common first names a username starts with:</p>

<ol>
  <li>John</li>
  <li>Sarah</li>
  <li>Ashley</li>
  <li>Emily</li>
  <li>Daniel</li>
  <li>Ryan</li>
  <li>Eric</li>
  <li>Brian</li>
  <li>Maria</li>
  <li>Lauren</li>
</ol>

<p>Another common pattern in usernames is to append a number at the end of your usernames.  How many numbers?</p>

<p><img src="/images/snapchat_leaks_image_3.png" alt="Distribution of Length of Appending Digits" /></p>

<p>Although two digits is the most common number of ending digits, we’ll take a look at four digits to get a better look at years.  What does this distribution look like?</p>

<p><img src="/images/snapchat_leaks_image_4.png" alt="Distribution of Four Number Digits" /></p>

<p>Clearly a lot of numbers other than years are chosen, so let’s zoom into the thick spike around the 1900s.  Also, let’s assume that the years are birth years and then turn the years into age.  Here is a five to 50 age distribution:</p>

<p><img src="/images/snapchat_leaks_image_5.png" alt="Four Year Digits Converted to Age" /></p>

<p>We see a big spike for age 13, which means many people chose to end their username in the number 2000.  Same for age 44: ending your username in 1969 was unusually popular.  I wouldn’t be surprised if the actual Snapchat age distribution looked similar to this.  We see the biggest change of users ranging in age from 13 to 23, so roughly middle school through college.  Keep in mind, however, that these conclusions are based on a number of assumptions and should be taken with a very large grain of salt.</p>

<p>Finally, there are all kinds of other factoids contained in these names.  The word “cat” occurs twice as many times as “dog”.  Lions are twice as popular as tigers.  There are over 5,000 sexy Snapchat users.  And so on.  A username is not just a username, but often tells us a bit more about the person lurking behind that name.</p>

<p>Gibson security has <a href="http://lookup.gibsonsec.org/">some good advice</a> for those whose information has been compromised: you can delete your Snapchat account, change your phone number, and never give out your phone number if you don’t have to.  The moral of the story is that even super-popular services getting billion dollar buyout offers aren’t immune to user data leaks, so be sure you take your online privacy seriously.</p>

<p><em><a href="http://www.forbes.com/sites/sap/2014/01/08/leaked-snapchat-data-uncovers-surprising-patterns/">This story was originall published on Forbes.</a></em></p>

          </article>
        </div>
    
      <!--<li>
        <span class="post-meta">Nov 26, 2013</span>

        <h2>
          <a class="post-link" href="/2013/11/26/hanukkah-or-chanukah-a-look-at-the-data-reveals-an-emerging-consensus.html">Hanukkah or Chanukah? A Look at the Data Reveals an Emerging Consensus</a>
        </h2>
      </li>-->

      <div class="post">
          <header class="post-header">
            <h1 class="post-title">Hanukkah or Chanukah? A Look at the Data Reveals an Emerging Consensus</h1>     
            <p class="post-meta">Nov 26, 2013 | <a href="/2013/11/26/hanukkah-or-chanukah-a-look-at-the-data-reveals-an-emerging-consensus.html">Permalink</a></p>
          </header>

          <article class="post-content">
            <iframe src="https://player.vimeo.com/video/8264593" width="740" height="555" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>
<p><a href="http://vimeo.com/8264593">“How Do You Spell Channukkahh?”</a> is the title of song recorded by The LeeVees, and for this year’s Hanukkah holiday I wondered if we could answer the question once and for all.</p>

<p>The Hebrew word for Hanukkah is חנוכה. But what is the English transliteration? Hanukkah? Chanukkah? Hannukah?  To find out and settle the question for good (or at least put you on the right side of history), I decided to take a look at the data.</p>

<p>We’ll look at three data sources: SAP’s Social Media Analytics by NetBase, Google Search Trends, and Google Ngram Viewer, which shows us how often a particular term has been used in books.  The confusion around the spelling is wether it begins with a C or an H, and just how many N’s and K’s are required. The spellings we’ll consider are:</p>

<ul>
  <li>Hanukah</li>
  <li>Hanukkah</li>
  <li>Hannukah</li>
  <li>Hannukkah</li>
  <li>Chanukah</li>
  <li>Chanukkah</li>
  <li>Channukah</li>
  <li>Channukkah</li>
</ul>

<p>First up, SAP Social Media Analytics by NetBase, which will give us access to a broad set of social data, including Twitter, Facebook, forums, blogs, and more.  Figure 1 shows the number of mentions of each spelling over the past year, and the spelling favorite is clear: Hanukkah.  Chanukah and Hannukah pull in a distant 2nd and 3rd.  The bottom three spellings are so infrequent that we could chalk them up to spelling mistakes.</p>

<p><img src="/images/2013-11-26/Figure 1 - Hanukkah Mentions Netbase Absolute.jpg" alt="Figure 1 - Hanukkah Mentions Netbase Absolute" /></p>

<p>So how does this compare to our other data sources?  Next up, Google searches.</p>

<p>Google provides a wealth of interesting public information, including data on people’s search history.  You can study searches via the Google Trends tool; for example, <a href="http://www.google.com/trends/explore?q=hanukkah%2C+chanukah">here is a simple comparison between “hanukkah” and “chanukah” going back to 2004</a>.  The scale is a bit wonky to understand since they don’t provide the absolute search volume of a term.  Rather, everything is scaled using the maximum point on the graph.  So in essence, one unit equals 1/100th of the search volume of the term which had the highest search volume for a period of time on the graph (<a href="https://support.google.com/trends/answer/87285?hl=en">you can read Google’s explanation here</a>).</p>

<p><img src="/images/2013-11-26/Figure 2 - Hanukkah Google Search Share 12 Months.jpg" alt="Figure 2 - Hanukkah Google Search Share 12 Months" /></p>

<p>Let’s start by comparing how often each spelling is used in Google searches over the past year vis-a-vis each other.  We can see that the top three spellings make up roughly the same share in Google searches as they do in the NetBase dataset.  Beyond the top three (which together account for 96% of spelling variants) the bottom diverges a bit more; for example, while “hanukah” appears on 0.03% of the time in the NetBase data it makes up 2% of the share here.  Since the Google data is less granular I suspect these small difference are due to noise.</p>

<p>In the end, we draw the same conclusion: <strong>about three out of four people spell the Jewish holiday Hanukkah, no C, one N and two K’s.</strong></p>

<p>Now the interesting thing about the Google data is that we can go back in time to see if there are any interesting patterns to detect.  I collected the data for our search terms going back to 2005.  Unsurprisingly, search volume dramatically peaks each year around the time that Hanukkah takes takes place.  In order to more easily compare year-over-year changes, I looked at only the three weeks before, during, and after the week in which the first day of Hanukkah fell (it varies each year).  What I found was pretty interesting.</p>

<p><img src="/images/2013-11-26/Figure 3 - Share of Google Search Results Timeline.jpg" alt="Figure 3 - Share of Google Search Results Timeline" /></p>

<p>As you can see in Figure 3, it appears that <strong>a consensus is emerging on how to spell Hanukkah.</strong>  The current dominant spelling variant was much less so in 2005, where it accounted for roughly 30-35%.  That means over the past decade, adoption of this spelling variant has doubled, mainly at the expense of the other two spelling variants that begin with H.  For the C variants, Chanukah remains the most popular option, with the other variants slowly fading away.</p>

<p>Finally, we can go even further back in time by means of Google’s ngram data set of the books its scanned.  An ngram is a continous sequence of items from a text; it can include single words, syllables, or sentence fragments.  You can explore Google’s data set with its <a href="https://books.google.com/ngrams">ngram viewer</a>, or <a href="http://storage.googleapis.com/books/ngrams/books/datasetsv2.html">download the data itself here</a>.  I downloaded the 1-gram data (single words) for ‘c’ and ‘h’ and loaded it into R.  What I was interested in is how many books each spelling variant appeared in.</p>

<p><img src="/images/2013-11-26/Figure 4 - Number of Books Containing Spelling Variant.jpg" alt="Figure 4 - Number of Books Containing Spelling Variant" /></p>

<p>Figure 4 shows the number of books that each spelling appeared in from 1950 to 2008 (the latest year that Google provides data for).  While this show us that there’s been an exponential  increase of the mentions of the holiday in books since 1980, we can compare spelling popularity more easily by comparing the share of spellings. </p>

<p><img src="/images/2013-11-26/Figure 5 - Share of Books Containing Spelling Variant.jpg" alt="Figure 5 - Share of Books Containing Spelling Variant" /></p>

<p>Figure 5 shows us the relative frequency with which each spelling variant has been used. The first thing to notice is that the proportions of each roughly match our previous two data sets.  But here the long-term trend has been a bit more stable.  The “Hanukkah” spelling does seem to gain a bit more share after 1980, and in general some of the less popular spellings decrease over time.</p>

<p>If you want to know how to spell Hanukkah, you’re best bet is <strong>Hanukkah</strong>, but you’ll be in good company if you prefer <strong>Chanukah</strong>.  The advantage of using several different data sets is that we can be more comfortable in our conclusions if the data reinforce one another, and in our case we were also able to inspect trends over different time horizons.</p>

<p>Happy Hanukkah!</p>

<iframe width="740" height="555" src="https://www.youtube.com/embed/Rd1Pyu9_rxo" frameborder="0" allowfullscreen=""></iframe>

          </article>
        </div>
    
      <!--<li>
        <span class="post-meta">May 14, 2013</span>

        <h2>
          <a class="post-link" href="/2013/05/14/how-to-create-a-google-earth-choropleth-map.html">How to Create a Google Earth Choropleth Map: Chester County 2012 General Election</a>
        </h2>
      </li>-->

      <div class="post">
          <header class="post-header">
            <h1 class="post-title">How to Create a Google Earth Choropleth Map: Chester County 2012 General Election</h1>     
            <p class="post-meta">May 14, 2013 | <a href="/2013/05/14/how-to-create-a-google-earth-choropleth-map.html">Permalink</a></p>
          </header>

          <article class="post-content">
            <p><strong>Summary:</strong> In this post I will show you how I created a Google Earth choropleth map of the 2012 Presidential Election results of the precincts in Chester County, Pennsylvania.  Here is the final result:</p>

<p><img src="/images/choropleth_01.jpg" alt="Choropleth Post Image 01" /></p>

<p>Here are the links to some of the tools and resources we’ll be talking about (for easy later reference):</p>

<ul>
  <li><a href="http://www.census.gov/geo/www/tiger/tgrshp2010/tgrshp2010.html">2010 Census TIGER/Line® Shapefiles</a></li>
  <li><a href="https://geodacenter.asu.edu/software/downloads">GeoDa</a></li>
  <li><a href="http://www.zonums.com/shp2kml.html">shp2kml</a></li>
</ul>

<h2 id="background">Background</h2>

<p>For different scenarios it is useful to understand people’s political leanings on a granular level.  For me personally, this interest started because I am currently looking to buy a house in Chester County, but obviously there are many other reasons why such a map might be useful (e.g. for political campaigns who want to maximize resource expenditure).</p>

<p>Most election result data and maps only go down to the level of individual counties, <a href="http://www.washingtonpost.com/wp-srv/special/politics/election-map-2012/president/">such as this Washington Post map</a>:</p>

<p><img src="/images/choropleth_02.png" alt="Choropleth Post Image 02" /></p>

<p>So in a toss-up state, Chester County is a toss-up county: 49.7% Romney and 49.2% Obama.  For purposes of looking at real estate, this is however still too coarse.  So I wondered how I could get at a more detailed breakdown.</p>

<h2 id="overview">Overview</h2>

<p>Here’s what we’ll be doing in a nutshell: get election data and tie it to the map shapefiles of Chester County voting precincts, then converting those shapefiles to KML files so we can view the map in Google Earth.</p>

<h2 id="getting-the-data">Getting the Data</h2>

<p>The lowest level of political data I could get my hands on were the Chester County (CC) precinct results, which are conveniently located here: <a href="http://www.chesco.org/index.aspx?NID=2367">Chester County Election Results Archive</a>.  Inconveniently, the data for each precinct is contained in a separate PDF.  To use the data in our map, we’ll need it all together in one place.  So I went through all 200+ PDFs and transcribed the precinct data in Excel (yes it sucked).  <a href="/files/Chester-County-2012-Presidental-Election-Data.csv">Here’s the data in CSV format</a>.  Note that I only picked out votes for Romney or Obama, not all the other information contained in the precinct reports.</p>

<p>So now we have the voting data, we’ll need the map data (in the form of <a href="http://en.wikipedia.org/wiki/Shapefile">shapefiles</a>) of Chester County precincts.  We could create those ourselves, but who has time for that.  What I found was the <a href="http://www.census.gov/geo/www/tiger/tgrshp2010/tgrshp2010.html">2010 Census TIGER/Line® Shapefiles</a> (there’s also the <a href="http://www2.census.gov/cgi-bin/shapefiles/state-files?state=42">2008 TIGER/Line® Shapefiles for: Pennsylvania</a>).  Click on “Download Shapefiles” on the left, then “Voting Districts” from the dropdown and then select the state and county.  <a href="http://www.leeclemmer.com/wp-content/uploads/2013/05/tl_2010_42029_vtd10.zip">You’ll get a package like this one for Chester County</a>.</p>

<p>Now that we have the data and the map shapefiles we come to the hardest part of this exercise: marrying the data with the map.</p>

<h2 id="map-meet-data-data-meet-map">Map Meet Data, Data Meet Map</h2>

<p>So admittedly I am not expert on shapefiles, I have plenty more learning to do there.  For a better explanation of what a shapefile is, <a href="http://en.wikipedia.org/wiki/Shapefile">consult your encyclopedia</a>.  Important for us, there are two files that interact: the actual shapefile (.shp extension) which contains the geometry of polygons, and a data file (.dbf extension) which contains data connected to the shapes - in our cases respresenting voting precincts.</p>

<p>From my Google searches the following tasks are best accomplished in <a href="http://www.esri.com/software/arcgis">ArcGIS</a>, the industry standard mapping software by a company called esri, but it costs.  So we will use three other tools: GeoDa, Excel 2010, and Access 2010. Theoretically we don’t really need GeoDa, but it helps to see what’s going on.</p>

<p>So when you open the shapefile (.shp extension) in GeoDa (<a href="https://geodacenter.asu.edu/software/downloads">free download</a>) you’ll see something like this:</p>

<p><img src="/images/choropleth_03.png" alt="Choropleth Post Image 03" /></p>

<p> 
You can also look at the data associated with the shapefile which is contained in the .dbf file.  Just click on that little table icon (third from left) and you’ll see something like this:</p>

<p><img src="/images/choropleth_04.png" alt="Choropleth Post Image 04" /></p>

<p>There’s nothing there now that’s really interesting for us, other than the names of the actual voting precincts.  What we need is the voting data.  In the source data file (the .csv file), we have votes for both Romney and Obama.  To combine these in just one column (since the coloring will be based on one variable as contained in one column) I just used the percentage of votes for Obama, with Romney representing the flipside.  So a 34% vote Obama would simply mean a 66% vote for Romney (nevermind the 1% third party candidates).  This’ll make sense when you take a look at the Category Editor screenshot below and look at the breaks compared to the labels.</p>

<p>At this point we could just add a column and input the voting percentages for Obama for each precinct.  This is what I initially did, but editing this in Excel is much faster, so we’ll do that.  Here’s what you need to do:</p>

<ol>
  <li>Make copies of all the shapefiles and work on those</li>
  <li>In Excel, open the .dbf file</li>
  <li>Add a column called “Vote” with the percentage of votes for Obama (or Romney, doesn’t matter)</li>
  <li>You cannot save back to .dbf format, so save as .xlsx</li>
  <li>Open MS Access</li>
  <li>Under External Data import Excel and choose the .xlsx file you just created; be sure to select the first row as column headers</li>
  <li>Then export it (under External Data &gt; Export &gt; More) as a dBase File. Pick a name and click Ok</li>
</ol>

<p>Now when you reopen the shapefile in GeoDa, you’ll see the column you just added:</p>

<p><img src="/images/choropleth_05.png" alt="Choropleth Post Image 05" /></p>

<h2 id="color-coding-the-map-choroplethic">Color-coding the Map: Choroplethic!</h2>

<p>At this point, you can already create a choropleth map in GeoDa.  Right-click on the map and select Change Current Map Type &gt; Create New Custom.  Play around with the breaks and labels and such.  Here’s what I came up with:</p>

<p><img src="/images/choropleth_06.png" alt="Choropleth Post Image 06" /></p>

<p><img src="/images/choropleth_07.png" alt="Choropleth Post Image 07" /></p>

<p>Already pretty cool!  But we’d like to see some of the underlying geographic data so we can do some more in-depth analysis of what’s going on. For example, why is there such a big Obama supporting precinct surrounded by Republican precincts in the lower left corner?</p>

<p>This last part is thankfully easy.</p>

<p>You’ll need to a <a href="http://www.zonums.com/shp2kml.html">download a little stand-alone program called shp2kml</a>.  This will convert your .shp file (including data) into a .kml file which can be viewed on Google Earth.  Here are the settings I used:</p>

<p><img src="/images/choropleth_08.png" alt="Choropleth Post Image 08" /></p>

<p><img src="/images/choropleth_09.png" alt="Choropleth Post Image 09" /></p>

<p><img src="/images/choropleth_10.png" alt="Choropleth Post Image 10" /></p>

<p><img src="/images/choropleth_11.png" alt="Choropleth Post Image 11" /></p>

<p>On that last screen, click “Create and Open”, pick a file name, and voila, Google Earth opens with your awesome choropleth map: sweet!</p>

<p>Now we can see that in an otherwise sparsely populated district, we find Lincoln University: this likely explains why there is such a pro-Obama precinct in otherwise Republican territory:</p>

<p><img src="/images/choropleth_12.png" alt="Choropleth Post Image 12" /></p>

          </article>
        </div>
    
      <!--<li>
        <span class="post-meta">Nov 7, 2012</span>

        <h2>
          <a class="post-link" href="/2012/11/07/post-election-model-evaluation-against-actual.html">Post-Election Model Evaluation Against Actual Results: a Victory for State Polls</a>
        </h2>
      </li>-->

      <div class="post">
          <header class="post-header">
            <h1 class="post-title">Post-Election Model Evaluation Against Actual Results: a Victory for State Polls</h1>     
            <p class="post-meta">Nov 7, 2012 | <a href="/2012/11/07/post-election-model-evaluation-against-actual.html">Permalink</a></p>
          </header>

          <article class="post-content">
            <p>So, here we are, November 7, and Barack Obama has been re-elected POTUS.  This came as a surprise to no-one who’s been watching the polls and following <a href="http://fivethirtyeight.blogs.nytimes.com/">Nate Silver</a>.  Well, maybe to Dean Chambers of Unskewedpolls.com.  Poor guy.</p>

<p>Nate did extremely well, correctly predicting all states and the overall election.  He had Florida at 50/50, and here it is, still undecided because it’s so close.</p>

<p>And how did my humble prediction model do? Equally well! (<a href="/2012/11/06/competing-with-nate-silver-in-under-200-lines-of.html">Read yesterday’s predictions here.</a>)  Here are Nate’s and my predictions for competitive states (any state beyond 100% certainty):</p>

<p><img src="/images/2012-11-07-post-election-1.png" alt="2012-11-07 Post Election Image 1" /></p>

<p>Actual winners highlighted in blue or red.  The sole holdout is Florida, which we had at 50/50.
Taking a look at my projected likely outcomes for an Obama win:</p>

<p><img src="/images/2012-11-07-post-election-2.png" alt="2012-11-07 Post Election Image 2" /></p>

<p>The first two paths to victory are his actual paths to victory.  At the moment, CNN has Obama with 303 Electoral College votes, but if Obama wins Florida, he’ll get the 332. The outcomes above reflect the fact that Obama is slightly more likely to get Florida than not, and in actual fact this is what it’s looking like right now.</p>

<p>Another way to look at the accuracy of the model is to compare the computed state averages based on state polls to the actual election outcomes:</p>

<p><img src="/images/2012-11-07-post-election-3.png" alt="2012-11-07 Post Election Image 3" /></p>

<p>What we’re looking at here is the competitive states, sorted by how much the actual spread (based on election results) between D and R varied from the projected spread. One way to read this is that the undecideds broke more one way than the other.  In Arizona, for example, the polls had Obama at 43%, which is what he actually got. Romney, however, picked up 55% of the vote instead of the projected 50%.  This could be interpreted by reasoning that the additional 5% that Romney received were undecideds in the poll.  The average spread difference in these competitive states was only 2 - not bad!  Looks like the state polls were pretty good indicators of how the election would pan out.</p>

<p>Overall, my simple model did extremely well, actually surprisingly so, given how simple it is. The way it works is:</p>

<ol>
  <li>Take the average D and R percentage and margin of error of the past X number of state polls for a given state (I’ve been using 10) for all states</li>
  <li>Simulate the election outcome by randomly picking a vote percentage value within the margin of error for each state, determining the winner, and allocating the appropriate number of Electoral College votes for the winner</li>
  <li>Do this 1,000,000 times and determine the percentage that each candidate won (or there was a tie); this is a Monte Carlo simulation to determine the probabilities of an outcome</li>
</ol>

<p>That’s basically it.  How many polls to look back in this case was pretty arbitrary (10).  Using a lower number gives you possibly a bit fresher set of data (the polls were taken more recently) but leaves you a bit more exposed to potential outliers.  For example, if you look at <a href="/2012/11/06/competing-with-nate-silver-in-under-200-lines-of.html">my post from yesterday</a>, you can see that using only the past 5 polls Florida had a probability of 37% Dem to 63% Rep.  Here are the past 5 polls:</p>

<p><img src="/images/2012-11-07-post-election-4.png" alt="2012-11-07 Post Election Image 4" /></p>

<p>We can see here that the InsiderAdvantage poll was an outlier and had Romney at +5.  Using the past 10 polls smoothed this outlier out.</p>

<p>What’s remarkable to me is the accuracy of this model given how dumb it is.  Part of Nate’s secret sauce is his weighting of polls. You can see the weights when you hover over the little bar chart. For example, the weight given to the InsiderAdvantage polls was 0.57976 vs. 1.411115 for the PPP poll:</p>

<p><img src="/images/2012-11-07-post-election-5.png" alt="2012-11-07 Post Election Image 5" /></p>

<p>We don’t know exactly how these numbers are determined, but we know that variables such as time, polling house effect, sample size, etc. go into this weight. My model did none of this weighting, which is probably the first area I would start improving it. Nonetheless, the results are quite similar, so the question is, how much bang for your buck do we get from additional complexity.  There’s of course also the possibility that this simple model just happened to work out, and that under different conditions a more nuanced approached would be more accurate.  This is probably the more likely case.  But the takeaway is that you don’t need an overly complex model to come up with some pretty decent predictions on your own.</p>

<p>Another area where the model fudges is in taking the average: it takes the poll averages (e.g. 50% Obama and 48% Obama averages out to 49% Obama), but it also averages the margin of error.  Well, the more data you have and the larger the sample of voters that were surveyed, the smaller the margin of error will become.  I did not take this fact into consideration and simply averaged the margin of errors, yielding undue uncertainty for each average.
My model also did not take other factors into consideration in making the final prediction: no economic factors or national polls - just the state polls.</p>

<p>In all, I finish with the following observations:</p>

<ul>
  <li>In 2012, state polls were excellent predictors of the election outcome when considered in the aggregate.  It is finally time for the media to stop writing articles about single polls without putting them into the context of the larger picture.  If a candidate is up by 2 points in state, we’ll see polls that show a candidate up 4 and tied.  Putting out an article talking about a tied race is simply misleading.</li>
  <li>Nate talked about the possibility of a systemic bias in the polls.  There appeared to be none when considered in the aggregate.</li>
  <li>A model doesn’t have to be complex to be of value and reveal underlying trends in a set of data.</li>
  <li>Data trumps gut feelings and intuition in making election predictions.  Be wary of pundits who don’t talk about their conclusions based on what’s happening in the polls or other relevant data.</li>
  <li>Python rocks!</li>
</ul>

          </article>
        </div>
    
      <!--<li>
        <span class="post-meta">Nov 6, 2012</span>

        <h2>
          <a class="post-link" href="/2012/11/06/competing-with-nate-silver-in-under-200-lines-of.html">Competing with Nate Silver in Under 200 Lines of Python Code - Election 2012 Result Predictions</a>
        </h2>
      </li>-->

      <div class="post">
          <header class="post-header">
            <h1 class="post-title">Competing with Nate Silver in Under 200 Lines of Python Code - Election 2012 Result Predictions</h1>     
            <p class="post-meta">Nov 6, 2012 | <a href="/2012/11/06/competing-with-nate-silver-in-under-200-lines-of.html">Permalink</a></p>
          </header>

          <article class="post-content">
            <p>UPDATE: <a href="/2012/11/07/post-election-model-evaluation-against-actual.html">Post-election analysis here</a></p>

<p>It’s November 6, and over 18 months of grueling and never-ending campaigning is finally coming to an end.  I’m admittedly a bit of a political news junkie and check <a href="http://www.memeorandum.com/">memeorandum</a> religiously to get a pulse of what’s being talked about.  Together with the <a href="http://www.wired.com/business/2012/04/opinion-baio-site-bias/">Chrome plugin visualizing political bias</a>, it’s a great tool.</p>

<p>However, the past few years have been especially partisan and the rhetoric in the blogosphere is rancid.  So it was truly a breath of fresh air when I discovered Nate Silver in the beginning of the summer.  No bullshit - just the facts.  What a concept!  So Nate has been become the latest staple of my info diet.</p>

<p>He’s been catching a ton of flack in the past few months for his statistical, evidence based model that has consistently favored Obama in spite of media hype to the contrary.  All of the arguments against him don’t really hold much weight unless they are actually addressing the model himself.</p>

<p>One article in particular caught my attention: <a href="http://dailycaller.com/2012/11/01/is-nate-silvers-value-at-risk/">“Is Nate Silver’s value at risk?”</a> by Sean Davis over at The Daily Caller.  His argument basically boils down to the question of whether state polls are accurate in predicting election outcomes, and whether Nate Silver’s model has relied to heavily on this data.  After re-creating Nate’s model (in Excel?!), Sean writes:</p>

<blockquote>
  <p>After running the simulation every day for several weeks, I noticed something odd: the winning probabilities it produced for Obama and Romney were nearly identical to those reported by FiveThirtyEight. Day after day, night after night. For example, based on the polls included in RealClearPolitics’ various state averages as of Tuesday night, the Sean Davis model suggested that Obama had a <a href="https://pbs.twimg.com/media/A6lmDZJCAAAWSX0.png:large">73.0% chance of winning the Electoral College</a>. In contrast, Silver’s FiveThirtyEight model as of Tuesday night forecast that Obama had a 77.4% chance of winning the Electoral College.</p>
</blockquote>

<blockquote>
  <p>So what gives? If it’s possible to recreate Silver’s model using just Microsoft Excel, <a href="http://www.thumbstacks.com/">a cheap Monte Carlo plug-in</a>, and poll results that are widely available, then what real predictive value does Silver’s model have?</p>
</blockquote>

<blockquote>
  <p>The answer is: not all that much beyond what is already contained in state polls. Why? Because the FiveThirtyEight model is a complete slave to state polls. When state polls are accurate, FiveThirtyEight looks amazing. But when state polls are incorrect, FiveThirtyEight does quite poorly. That’s why my very simple model and Silver’s very fancy model produce remarkably similar results — they rely on the same data. Garbage in, garbage out.</p>
</blockquote>

<p>So what happens if state polls are incorrect?</p>

<p>It’s a good question, although Sean’s answer isn’t particularly satisfactory: he basically says we probably don’t have enough data.</p>

<p>However, this piqued my interest… was it really so easy to emulate his model?  I wanted to find out more… the Monte Carlo plugin is $129: screw that.  I bit of Googling later and it turns out Monte Carlo simulations are <a href="http://niallohiggins.com/2007/07/05/monte-carlo-simulation-in-python-1/">pretty easy to do in Python</a>.</p>

<p>So after creating a few arrays to hold the latest polls for each state (via both RealClearPolitics and 538), I ran the numbers. I’ll perhaps go into the code in a separate post, but for right now, let me just post my predictions along with Nate’s.</p>

<p>Let’s start with state-by-state probabilities.  I’ve listed Nate’s state probabilities, and then two version of my predictions.  The model I’m using is really super simple.  I take the average of the past X number of polls and then run the Monte Carlo simulation on those percentages and margin of errors.  That’s how I come up with the state probabilities.  The “Diff” column then lists the difference between my predictions and Nate’s predictions.</p>

<p><img src="/images/2012-11-06-election-1.png" alt="2012-11-06 Election Image 01" /></p>

<p>Everything is in the general ballpark, which for under 200 lines of Python code isn’t bad I think!  The average difference using the past 10 polls is 5%, while the average difference using the past 5 polls is 4% (looking only at those states where our probabilities differed).  Like I said, not bad, and in no case, do we predict different winners altogether (with the exception of a the 5 poll projection calling for Romney to win Florida).</p>

<p>So, who’s gonna win it all?  Using the above percentages and simulating an election 1,000,000 times, I get the following, using first the past 10 and then then past 5 results:</p>

<p><img src="/images/2012-11-06-election-2.png" alt="2012-11-06 Election Image 02" /></p>

<p>Using the 10 last polls is somewhat close to Nate, but overall, again, we’re in the same ballpark and the story being told is the same.  Obama is the heavy favorite to win it tonight with roughly 10:1 odds in his favor.</p>

<p>Now let’s look at the most likely paths to victory for each candidate.  For Obama, the following 5 paths occurred most often in the simulation:</p>

<p><img src="/images/2012-11-06-election-3.png" alt="2012-11-06 Election Image 03" /></p>

<p>M2 here stands for Maine’s 2nd Congressional District.  Maine and Nebraska apportion their Electoral Votes one for each Congressional District (Maine has 2, Nebraska 3) plus 2 for the overall vote winner.</p>

<p><img src="/images/2012-11-06-election-4.png" alt="2012-11-06 Election Image 04" /></p>

<p>You can see why Ohio is so pivotal for Romney.  Here are the most likely paths without Ohio:</p>

<p><img src="/images/2012-11-06-election-5.png" alt="2012-11-06 Election Image 05" /></p>

<p>Certainly puts his late push into PA into some perspective.</p>

<p>Well if you do happen upon this post and are actually interested in the Python code, let me know, and I might do a follow-up post looking at the code specifically.</p>

<p>Cheers, and enjoy the election!  I’d put my money on Obama!</p>

<p>UPDATE: <a href="/2012/11/07/post-election-model-evaluation-against-actual.html">Post-election analysis here</a></p>

          </article>
        </div>
    
  </ul>

  <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Lee Clemmer</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/leeclemmer">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">leeclemmer</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/leeclemmer">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">leeclemmer</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <p class="text">Occasional writing on data-related topics.
<br/>
        Hosted on <a href="https://pages.github.com/">Github Pages</a>, generated by <a href="https://jekyllrb.com/">Jekyll</a>.</p>
      </div>
    </div>

  </div>

</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2431727-37', 'auto');
  ga('send', 'pageview');

</script>


  </body>

</html>
